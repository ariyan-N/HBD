<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>HBD Love</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<link type="text/css" rel="stylesheet" href="./file/default.css">
<script src="./file/jquery.min.js"></script>
<script src="./file/jscex.min.js"></script>
<script src="./file/jscex-parser.js"></script>
<script src="./file/jscex-jit.js"></script>
<script src="./file/jscex-builderbase.min.js"></script>
<script src="./file/jscex-async.min.js"></script>
<script src="./file/jscex-async-powerpack.min.js"></script>
<script src="./file/functions.js" charset="utf-8"></script>
<script src="./file/love.js" charset="utf-8"></script>

<style>
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    background: #fff;
}

#main, #wrap {
    width: 100%;
    height: 100%;
    position: relative;
}

#canvas {
    display: block;
    width: 100%;
    height: 100%;
}

#text {
    position: absolute;
    top: 5%;
    left: 50%;
    transform: translateX(-50%);
    text-align: center;
    width: 90%;
    color: #000;
}

#clock-box {
    position: absolute;
    bottom: 5%;
    left: 50%;
    transform: translateX(-50%);
    text-align: center;
    font-size: 1.2em;
}

#code span.say {
    display: block;
    font-size: 1.2em;
    margin: 4px 0;
}

@media (max-width: 768px){
    #code span.say {
        font-size: 1em;
    }
    #clock-box {
        font-size: 1em;
    }
}
</style>

<script>
function playAudio() {
    var audio = document.getElementById("myAudio");
    audio.play();
}
</script>
</head>

<body>
<div id="main">
    <div id="error" style="display:none;">
        <a href="http://www.google.cn/chrome/intl/zh-CN/landing_chrome.html?hl=zh-CN&brand=CHMI">Chrome</a>
        (<a href="http://firefox.com.cn/download/">Firefox</a>)
    </div>

    <audio autoplay id="myAudio">
        <source src="aud.mp3" type="audio/mp3">
    </audio>

    <div id="wrap">
        <div id="text">
            <div id="code" style="display:none;">
                <span class="say">My beautiful wife üíû</span>
                <span class="say">Happy Birthday üéà</span>
                <span class="say">May Allah bless you üçÄ</span>
                <span class="say">And give u many happiness üíï</span>
                <span class="say">I loved you ‚ù§Ô∏è</span>
                <span class="say">And I will always love u ü•∫ ‚ù§Ô∏è</span>
                <span class="say">Hope u have a great day today ‚ù§Ô∏èüòò</span>
            </div>
        </div>
        <div id="clock-box">
            <span id="clock">577 days 0 hours 0 minutes 0 seconds</span>
        </div>
        <canvas id="canvas"></canvas>
    </div>
</div>

<script>
(function(){
    var canvas = $('#canvas');
    if(!canvas[0].getContext){
        $("#error").show();
        return false;
    }

    // Always fullscreen without caring screen rotate
    var width = window.innerWidth;
    var height = window.innerHeight;
    canvas.attr("width", width);
    canvas.attr("height", height);

    var opts = {
        seed: { x: width/2 - 20, color:"rgb(190,26,37)", scale:2 },
        branch: [ /* same as original tree branch data */ ],
        bloom: { num:700, width: width, height: height-50 },
        footer: { width: width, height:5, speed:10 }
    };

    var tree = new Tree(canvas[0], width, height, opts);
    var seed = tree.seed;
    var foot = tree.footer;
    var hold = 1;

    canvas.click(function(e){
        playAudio();
        var offset = canvas.offset();
        var x = e.pageX - offset.left;
        var y = e.pageY - offset.top;
        if(seed.hover(x,y)){
            hold = 0;
            canvas.unbind("click").unbind("mousemove").removeClass('hand');
        }
    }).mousemove(function(e){
        var offset = canvas.offset();
        var x = e.pageX - offset.left;
        var y = e.pageY - offset.top;
        canvas.toggleClass('hand', seed.hover(x,y));
    });

    // Async animations same as original
    var seedAnimate = eval(Jscex.compile("async", function(){ seed.draw(); while(hold){$await(Jscex.Async.sleep(10));} while(seed.canScale()){seed.scale(0.95);$await(Jscex.Async.sleep(10));} while(seed.canMove()){seed.move(0,2); foot.draw(); $await(Jscex.Async.sleep(10));}}));
    var growAnimate = eval(Jscex.compile("async", function(){ do{tree.grow(); $await(Jscex.Async.sleep(10)); }while(tree.canGrow());}));
    var flowAnimate = eval(Jscex.compile("async", function(){ do{tree.flower(2); $await(Jscex.Async.sleep(10)); }while(tree.canFlower());}));
    var moveAnimate = eval(Jscex.compile("async", function(){ tree.snapshot("p1",240,0,610,680); while(tree.move("p1",500,0)){foot.draw();$await(Jscex.Async.sleep(10));} foot.draw(); tree.snapshot("p2",500,0,610,680); canvas.parent().css("background","url("+tree.toDataURL('image/png')+")"); canvas.css("background","#ffe"); $await(Jscex.Async.sleep(300)); canvas.css("background","none");}));
    var textAnimate = eval(Jscex.compile("async", function(){ $("#code").show().typewriter(); }));

    var runAsync = eval(Jscex.compile("async", function(){ $await(seedAnimate()); $await(growAnimate()); $await(flowAnimate()); $await(moveAnimate()); textAnimate().start(); }));

    runAsync().start();

})();
</script>
</body>
</html>
